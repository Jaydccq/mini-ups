<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NotificationPayload.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Mini UPS Backend</a> &gt; <a href="index.source.html" class="el_package">com.miniups.model.event</a> &gt; <span class="el_source">NotificationPayload.java</span></div><h1>NotificationPayload.java</h1><pre class="source lang-java linenums">package com.miniups.model.event;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.Instant;
import java.util.List;
import java.util.Map;

<span class="nc bnc" id="L11" title="All 182 branches missed.">@Data</span>
<span class="nc" id="L12">@NoArgsConstructor</span>
<span class="nc" id="L13">@AllArgsConstructor</span>
public class NotificationPayload {

<span class="nc" id="L16">    public enum NotificationType {</span>
<span class="nc" id="L17">        EMAIL,</span>
<span class="nc" id="L18">        SMS,</span>
<span class="nc" id="L19">        PUSH_NOTIFICATION,</span>
<span class="nc" id="L20">        IN_APP_NOTIFICATION,</span>
<span class="nc" id="L21">        WEBHOOK</span>
    }

<span class="nc" id="L24">    public enum Priority {</span>
<span class="nc" id="L25">        LOW,</span>
<span class="nc" id="L26">        NORMAL,</span>
<span class="nc" id="L27">        HIGH,</span>
<span class="nc" id="L28">        URGENT</span>
    }

    private String notificationId;
    private Long recipientUserId;
    private String recipientEmail;
    private String recipientPhone;
    private String deviceToken;
    private List&lt;NotificationType&gt; notificationTypes;
    private String subject;
    private String message;
    private String htmlContent;
    private String templateId;
    private Map&lt;String, Object&gt; templateVariables;
    private Priority priority;
<span class="nc" id="L43">    private Instant scheduledDeliveryTime;</span>
<span class="nc" id="L44">    private Instant expirationTime;</span>
    private Integer maxRetryAttempts;
    private Integer currentAttempt;
    private String category;
<span class="nc" id="L48">    private String relatedEntityId;</span>
<span class="nc" id="L49">    private String relatedEntityType;</span>
<span class="nc" id="L50">    private String deepLinkUrl;</span>
<span class="nc" id="L51">    private List&lt;NotificationAction&gt; actions;</span>
<span class="nc" id="L52">    private Map&lt;String, Object&gt; metadata;</span>

<span class="nc bnc" id="L54" title="All 38 branches missed.">    @Data</span>
<span class="nc" id="L55">    @NoArgsConstructor</span>
<span class="nc" id="L56">    @AllArgsConstructor</span>
    public static class NotificationAction {
<span class="nc" id="L58">        private String actionId;</span>
<span class="nc" id="L59">        private String label;</span>
<span class="nc" id="L60">        private String url;</span>
<span class="nc" id="L61">        private String actionType;</span>
    }

    public boolean isImmediate() {
<span class="nc bnc" id="L65" title="All 4 branches missed.">        return scheduledDeliveryTime == null || scheduledDeliveryTime.isBefore(Instant.now());</span>
    }

    public boolean isExpired() {
<span class="nc bnc" id="L69" title="All 4 branches missed.">        return expirationTime != null &amp;&amp; expirationTime.isBefore(Instant.now());</span>
    }

    public boolean isMaxRetriesExceeded() {
<span class="nc bnc" id="L73" title="All 4 branches missed.">        return maxRetryAttempts != null &amp;&amp; currentAttempt != null &amp;&amp; </span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">               currentAttempt &gt;= maxRetryAttempts;</span>
    }

    public void incrementAttempt() {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (currentAttempt == null) {</span>
<span class="nc" id="L79">            currentAttempt = 1;</span>
        } else {
<span class="nc" id="L81">            currentAttempt++;</span>
        }
<span class="nc" id="L83">    }</span>

    public boolean includesEmail() {
<span class="nc bnc" id="L86" title="All 4 branches missed.">        return notificationTypes != null &amp;&amp; notificationTypes.contains(NotificationType.EMAIL);</span>
    }

    public boolean includesSms() {
<span class="nc bnc" id="L90" title="All 4 branches missed.">        return notificationTypes != null &amp;&amp; notificationTypes.contains(NotificationType.SMS);</span>
    }

    public boolean includesPush() {
<span class="nc bnc" id="L94" title="All 4 branches missed.">        return notificationTypes != null &amp;&amp; notificationTypes.contains(NotificationType.PUSH_NOTIFICATION);</span>
    }

    public boolean usesTemplate() {
<span class="nc bnc" id="L98" title="All 4 branches missed.">        return templateId != null &amp;&amp; !templateId.trim().isEmpty();</span>
    }

    public boolean hasTemplateVariables() {
<span class="nc bnc" id="L102" title="All 4 branches missed.">        return templateVariables != null &amp;&amp; !templateVariables.isEmpty();</span>
    }

    public void addTemplateVariable(String key, Object value) {
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (templateVariables == null) {</span>
<span class="nc" id="L107">            templateVariables = new java.util.HashMap&lt;&gt;();</span>
        }
<span class="nc" id="L109">        templateVariables.put(key, value);</span>
<span class="nc" id="L110">    }</span>

    public void addMetadata(String key, Object value) {
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (metadata == null) {</span>
<span class="nc" id="L114">            metadata = new java.util.HashMap&lt;&gt;();</span>
        }
<span class="nc" id="L116">        metadata.put(key, value);</span>
<span class="nc" id="L117">    }</span>

    // Explicit getters and setters for Lombok compatibility
<span class="nc" id="L120">    public String getNotificationId() { return notificationId; }</span>
<span class="nc" id="L121">    public void setNotificationId(String notificationId) { this.notificationId = notificationId; }</span>
    
<span class="nc" id="L123">    public Long getRecipientUserId() { return recipientUserId; }</span>
<span class="nc" id="L124">    public void setRecipientUserId(Long recipientUserId) { this.recipientUserId = recipientUserId; }</span>
    
<span class="nc" id="L126">    public String getRecipientEmail() { return recipientEmail; }</span>
<span class="nc" id="L127">    public void setRecipientEmail(String recipientEmail) { this.recipientEmail = recipientEmail; }</span>
    
<span class="nc" id="L129">    public String getRecipientPhone() { return recipientPhone; }</span>
<span class="nc" id="L130">    public void setRecipientPhone(String recipientPhone) { this.recipientPhone = recipientPhone; }</span>
    
<span class="nc" id="L132">    public String getDeviceToken() { return deviceToken; }</span>
<span class="nc" id="L133">    public void setDeviceToken(String deviceToken) { this.deviceToken = deviceToken; }</span>
    
<span class="nc" id="L135">    public List&lt;NotificationType&gt; getNotificationTypes() { return notificationTypes; }</span>
<span class="nc" id="L136">    public void setNotificationTypes(List&lt;NotificationType&gt; notificationTypes) { this.notificationTypes = notificationTypes; }</span>
    
<span class="nc" id="L138">    public String getSubject() { return subject; }</span>
<span class="nc" id="L139">    public void setSubject(String subject) { this.subject = subject; }</span>
    
<span class="nc" id="L141">    public String getMessage() { return message; }</span>
<span class="nc" id="L142">    public void setMessage(String message) { this.message = message; }</span>
    
<span class="nc" id="L144">    public String getHtmlContent() { return htmlContent; }</span>
<span class="nc" id="L145">    public void setHtmlContent(String htmlContent) { this.htmlContent = htmlContent; }</span>
    
<span class="nc" id="L147">    public String getTemplateId() { return templateId; }</span>
<span class="nc" id="L148">    public void setTemplateId(String templateId) { this.templateId = templateId; }</span>
    
<span class="nc" id="L150">    public Map&lt;String, Object&gt; getTemplateVariables() { return templateVariables; }</span>
<span class="nc" id="L151">    public void setTemplateVariables(Map&lt;String, Object&gt; templateVariables) { this.templateVariables = templateVariables; }</span>
    
<span class="nc" id="L153">    public Priority getPriority() { return priority; }</span>
<span class="nc" id="L154">    public void setPriority(Priority priority) { this.priority = priority; }</span>
    
<span class="nc" id="L156">    public Integer getCurrentAttempt() { return currentAttempt; }</span>
<span class="nc" id="L157">    public void setCurrentAttempt(Integer currentAttempt) { this.currentAttempt = currentAttempt; }</span>
    
<span class="nc" id="L159">    public Integer getMaxRetryAttempts() { return maxRetryAttempts; }</span>
<span class="nc" id="L160">    public void setMaxRetryAttempts(Integer maxRetryAttempts) { this.maxRetryAttempts = maxRetryAttempts; }</span>
    
<span class="nc" id="L162">    public String getCategory() { return category; }</span>
<span class="nc" id="L163">    public void setCategory(String category) { this.category = category; }</span>

    @Override
    public String toString() {
<span class="nc" id="L167">        return String.format(&quot;NotificationPayload{id='%s', recipient=%d, types=%s, priority=%s}&quot;, </span>
                notificationId, recipientUserId, notificationTypes, priority);
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>