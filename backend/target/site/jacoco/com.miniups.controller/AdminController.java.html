<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Mini UPS Backend</a> &gt; <a href="index.source.html" class="el_package">com.miniups.controller</a> &gt; <span class="el_source">AdminController.java</span></div><h1>AdminController.java</h1><pre class="source lang-java linenums">/**
 * Admin Dashboard Controller
 * 
 * Features:
 * - Provides centralized admin dashboard API endpoints
 * - Supports comprehensive business data aggregation
 * - Includes KPI metrics, fleet management, and analytics
 * - Implements role-based access control for administrative functions
 * 
 * API Endpoints:
 * - GET /api/admin/dashboard/statistics: Get dashboard KPI metrics
 * - GET /api/admin/dashboard/activities: Get recent system activities
 * - GET /api/admin/fleet/overview: Get fleet overview and status
 * - GET /api/admin/fleet/drivers: Get driver management data
 * - GET /api/admin/orders/summary: Get order management summary
 * - GET /api/admin/analytics/trends: Get business trend analytics
 * - GET /api/admin/system/health: Get system health status
 * 
 * Permission Control:
 * - All endpoints require ADMIN role
 * - Sensitive operations are logged for audit purposes
 * - Data aggregation optimized for dashboard performance
 * 
 * @author Mini-UPS Team
 * @version 1.0.0
 */
package com.miniups.controller;

import com.miniups.model.dto.common.ApiResponse;
import com.miniups.service.AdminService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping(&quot;/api/admin&quot;)
@PreAuthorize(&quot;hasRole('ADMIN')&quot;)
public class AdminController {
    
<span class="nc" id="L46">    private static final Logger logger = LoggerFactory.getLogger(AdminController.class);</span>
    
    private final AdminService adminService;
    
<span class="nc" id="L50">    public AdminController(AdminService adminService) {</span>
<span class="nc" id="L51">        this.adminService = adminService;</span>
<span class="nc" id="L52">    }</span>
    
    /**
     * Get dashboard KPI statistics
     * 
     * @return Dashboard statistics including orders, revenue, fleet status
     */
    @GetMapping(&quot;/dashboard/statistics&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getDashboardStatistics() {
<span class="nc" id="L61">        logger.debug(&quot;Fetching dashboard statistics&quot;);</span>
        
<span class="nc" id="L63">        Map&lt;String, Object&gt; statistics = adminService.getDashboardStatistics();</span>
        
<span class="nc" id="L65">        return ResponseEntity.ok(ApiResponse.success(&quot;Dashboard statistics retrieved successfully&quot;, statistics));</span>
    }
    
    /**
     * Get recent system activities
     * 
     * @param pageable Pagination parameters
     * @return Recent system activities
     */
    @GetMapping(&quot;/dashboard/activities&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getRecentActivities(
            @PageableDefault(size = 10, sort = &quot;createdAt&quot;, direction = org.springframework.data.domain.Sort.Direction.DESC) Pageable pageable) {
        
<span class="nc" id="L78">        logger.debug(&quot;Fetching recent activities&quot;);</span>
        
<span class="nc" id="L80">        Map&lt;String, Object&gt; responseData = adminService.getRecentActivities(pageable);</span>
        
<span class="nc" id="L82">        return ResponseEntity.ok(ApiResponse.success(&quot;Recent activities retrieved successfully&quot;, responseData));</span>
    }
    
    /**
     * Get fleet overview and status
     * 
     * @return Fleet overview with truck locations and status
     */
    @GetMapping(&quot;/fleet/overview&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getFleetOverview() {
<span class="nc" id="L92">        logger.debug(&quot;Fetching fleet overview&quot;);</span>
        
<span class="nc" id="L94">        Map&lt;String, Object&gt; fleetOverview = adminService.getFleetOverview();</span>
        
<span class="nc" id="L96">        return ResponseEntity.ok(ApiResponse.success(&quot;Fleet overview retrieved successfully&quot;, fleetOverview));</span>
    }
    
    /**
     * Get driver management data
     * 
     * @return Driver information and assignments
     */
    @GetMapping(&quot;/fleet/drivers&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getDriverManagement() {
<span class="nc" id="L106">        logger.debug(&quot;Fetching driver management data&quot;);</span>
        
<span class="nc" id="L108">        Map&lt;String, Object&gt; responseData = adminService.getDriverManagement();</span>
        
<span class="nc" id="L110">        return ResponseEntity.ok(ApiResponse.success(&quot;Driver management data retrieved successfully&quot;, responseData));</span>
    }
    
    /**
     * Get order management summary
     * 
     * @return Order management data with filtering and bulk operations info
     */
    @GetMapping(&quot;/orders/summary&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getOrderSummary() {
<span class="nc" id="L120">        logger.debug(&quot;Fetching order management summary&quot;);</span>
        
<span class="nc" id="L122">        Map&lt;String, Object&gt; responseData = adminService.getOrderSummary();</span>
        
<span class="nc" id="L124">        return ResponseEntity.ok(ApiResponse.success(&quot;Order summary retrieved successfully&quot;, responseData));</span>
    }
    
    /**
     * Get business trend analytics
     * 
     * @return Analytics data for charts and trends
     */
    @GetMapping(&quot;/analytics/trends&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getAnalyticsTrends() {
<span class="nc" id="L134">        logger.debug(&quot;Fetching analytics trends&quot;);</span>
        
<span class="nc" id="L136">        Map&lt;String, Object&gt; trends = adminService.getAnalyticsTrends();</span>
        
<span class="nc" id="L138">        return ResponseEntity.ok(ApiResponse.success(&quot;Analytics trends retrieved successfully&quot;, trends));</span>
    }
    
    /**
     * Get system health status
     * 
     * @return System health metrics and status indicators
     */
    @GetMapping(&quot;/system/health&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; getSystemHealth() {
<span class="nc" id="L148">        logger.debug(&quot;Fetching system health status&quot;);</span>
        
<span class="nc" id="L150">        Map&lt;String, Object&gt; health = adminService.getSystemHealth();</span>
        
<span class="nc" id="L152">        return ResponseEntity.ok(ApiResponse.success(&quot;System health retrieved successfully&quot;, health));</span>
    }
    
    // ============================================
    // Fleet Management CRUD Operations
    // ============================================
    
    /**
     * Create a new truck
     * 
     * @param truckData Truck creation data
     * @return Created truck information
     */
    @PostMapping(&quot;/fleet/trucks&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; createTruck(@RequestBody Map&lt;String, Object&gt; truckData) {
<span class="nc" id="L167">        logger.debug(&quot;Creating new truck: {}&quot;, truckData);</span>
        
<span class="nc" id="L169">        Map&lt;String, Object&gt; createdTruck = adminService.createTruck(truckData);</span>
        
<span class="nc" id="L171">        return ResponseEntity.ok(ApiResponse.success(&quot;Truck created successfully&quot;, createdTruck));</span>
    }
    
    /**
     * Update an existing truck
     * 
     * @param truckId Truck ID to update
     * @param truckData Updated truck data
     * @return Updated truck information
     */
    @PutMapping(&quot;/fleet/trucks/{truckId}&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; updateTruck(@PathVariable Long truckId, @RequestBody Map&lt;String, Object&gt; truckData) {
<span class="nc" id="L183">        logger.debug(&quot;Updating truck {}: {}&quot;, truckId, truckData);</span>
        
<span class="nc" id="L185">        Map&lt;String, Object&gt; updatedTruck = adminService.updateTruck(truckId, truckData);</span>
        
<span class="nc" id="L187">        return ResponseEntity.ok(ApiResponse.success(&quot;Truck updated successfully&quot;, updatedTruck));</span>
    }
    
    /**
     * Delete a truck
     * 
     * @param truckId Truck ID to delete
     * @return Deletion confirmation
     */
    @DeleteMapping(&quot;/fleet/trucks/{truckId}&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; deleteTruck(@PathVariable Long truckId) {
<span class="nc" id="L198">        logger.debug(&quot;Deleting truck {}&quot;, truckId);</span>
        
<span class="nc" id="L200">        adminService.deleteTruck(truckId);</span>
        
<span class="nc" id="L202">        return ResponseEntity.ok(ApiResponse.success(&quot;Truck deleted successfully&quot;, null));</span>
    }
    
    /**
     * Create a new driver
     * 
     * @param driverData Driver creation data
     * @return Created driver information
     */
    @PostMapping(&quot;/fleet/drivers&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; createDriver(@RequestBody Map&lt;String, Object&gt; driverData) {
<span class="nc" id="L213">        logger.debug(&quot;Creating new driver: {}&quot;, driverData);</span>
        
<span class="nc" id="L215">        Map&lt;String, Object&gt; createdDriver = adminService.createDriver(driverData);</span>
        
<span class="nc" id="L217">        return ResponseEntity.ok(ApiResponse.success(&quot;Driver created successfully&quot;, createdDriver));</span>
    }
    
    /**
     * Update an existing driver
     * 
     * @param driverId Driver ID to update
     * @param driverData Updated driver data
     * @return Updated driver information
     */
    @PutMapping(&quot;/fleet/drivers/{driverId}&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; updateDriver(@PathVariable Long driverId, @RequestBody Map&lt;String, Object&gt; driverData) {
<span class="nc" id="L229">        logger.debug(&quot;Updating driver {}: {}&quot;, driverId, driverData);</span>
        
<span class="nc" id="L231">        Map&lt;String, Object&gt; updatedDriver = adminService.updateDriver(driverId, driverData);</span>
        
<span class="nc" id="L233">        return ResponseEntity.ok(ApiResponse.success(&quot;Driver updated successfully&quot;, updatedDriver));</span>
    }
    
    /**
     * Delete a driver
     * 
     * @param driverId Driver ID to delete
     * @return Deletion confirmation
     */
    @DeleteMapping(&quot;/fleet/drivers/{driverId}&quot;)
    public ResponseEntity&lt;ApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt; deleteDriver(@PathVariable Long driverId) {
<span class="nc" id="L244">        logger.debug(&quot;Deleting driver {}&quot;, driverId);</span>
        
<span class="nc" id="L246">        adminService.deleteDriver(driverId);</span>
        
<span class="nc" id="L248">        return ResponseEntity.ok(ApiResponse.success(&quot;Driver deleted successfully&quot;, null));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>