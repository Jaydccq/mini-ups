<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Shipment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Mini UPS Backend</a> &gt; <a href="index.source.html" class="el_package">com.miniups.model.entity</a> &gt; <span class="el_source">Shipment.java</span></div><h1>Shipment.java</h1><pre class="source lang-java linenums">/**
 * 运输订单实体类
 * 
 * 功能说明：
 * - Mini-UPS系统的核心业务实体，记录包裹运输的完整生命周期
 * - 管理从下单到配送完成的全部状态变化
 * - 与用户、卡车、包裹等实体建立关联关系
 * 
 * 主要字段：
 * - shipmentId: Amazon系统的运输订单ID
 * - upsTrackingId: UPS生成的追踪号码
 * - status: 运输状态(CREATED/PICKED_UP/IN_TRANSIT/DELIVERED等)
 * - truck: 分配的运输卡车
 * - destinations: 目标地址坐标和详细地址
 * 
 * 数据库设计：
 * - 表名: shipments
 * - 索引: shipment_id、tracking_id、status、user_id
 * - 外键: user_id(用户)、truck_id(卡车)
 * 
 * 业务流程：
 * 1. Amazon创建运输订单
 * 2. UPS分配卡车和生成追踪号
 * 3. 卡车前往取货点
 * 4. 运输中实时更新位置
 * 5. 到达目的地完成配送
 * 
 * @author Mini-UPS Team
 * @version 1.0.0
 */
package com.miniups.model.entity;

import com.miniups.model.enums.ShipmentStatus;
import jakarta.persistence.*;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Size;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = &quot;shipments&quot;, indexes = {
    @Index(name = &quot;idx_shipment_shipment_id&quot;, columnList = &quot;shipment_id&quot;),
    @Index(name = &quot;idx_shipment_tracking_id&quot;, columnList = &quot;ups_tracking_id&quot;),
    @Index(name = &quot;idx_shipment_status&quot;, columnList = &quot;status&quot;),
    @Index(name = &quot;idx_shipment_user&quot;, columnList = &quot;user_id&quot;)
})
public class Shipment extends BaseEntity {
    
    @NotBlank
    @Size(max = 100)
    @Column(name = &quot;shipment_id&quot;, nullable = false, unique = true, length = 100)
    private String shipmentId;
    
    @Size(max = 100)
    @Column(name = &quot;ups_tracking_id&quot;, unique = true, length = 100)
    private String upsTrackingId;
    
    @Size(max = 100)
    @Column(name = &quot;amazon_order_id&quot;, length = 100)
    private String amazonOrderId;
    
<span class="pc" id="L66">    @Enumerated(EnumType.STRING)</span>
    @Column(name = &quot;status&quot;, nullable = false, length = 20)
    private ShipmentStatus status = ShipmentStatus.CREATED;
    
    @NotNull
    @Column(name = &quot;origin_x&quot;, nullable = false)
    private Integer originX;
    
    @NotNull
    @Column(name = &quot;origin_y&quot;, nullable = false)
    private Integer originY;
    
    @NotNull
    @Column(name = &quot;dest_x&quot;, nullable = false)
    private Integer destX;
    
    @NotNull
    @Column(name = &quot;dest_y&quot;, nullable = false)
    private Integer destY;
    
    @Column(name = &quot;weight&quot;, precision = 10, scale = 2)
    private BigDecimal weight;
    
    @Column(name = &quot;estimated_delivery&quot;)
    private LocalDateTime estimatedDelivery;
    
    @Column(name = &quot;actual_delivery&quot;)
    private LocalDateTime actualDelivery;
    
    @Column(name = &quot;pickup_time&quot;)
    private LocalDateTime pickupTime;
    
    @Column(name = &quot;world_id&quot;)
    private Long worldId;
    
    @Column(name = &quot;delivery_address&quot;)
    private String deliveryAddress;
    
    @Column(name = &quot;delivery_city&quot;)
    private String deliveryCity;
    
    @Column(name = &quot;delivery_zip_code&quot;)
    private String deliveryZipCode;
    
    // Relationships
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;user_id&quot;)
    private User user;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;truck_id&quot;)
    private Truck truck;
    
<span class="pc" id="L119">    @OneToMany(mappedBy = &quot;shipment&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span>
    private List&lt;ShipmentPackage&gt; packages = new ArrayList&lt;&gt;();
    
<span class="pc" id="L122">    @OneToMany(mappedBy = &quot;shipment&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span>
    private List&lt;ShipmentStatusHistory&gt; statusHistory = new ArrayList&lt;&gt;();
    
<span class="pc" id="L125">    @OneToMany(mappedBy = &quot;shipment&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span>
    private List&lt;AddressChange&gt; addressChanges = new ArrayList&lt;&gt;();
    
    // Constructors
<span class="fc" id="L129">    public Shipment() {}</span>
    
    public Shipment(String shipmentId, Integer originX, Integer originY, 
<span class="nc" id="L132">                   Integer destX, Integer destY) {</span>
<span class="nc" id="L133">        this.shipmentId = shipmentId;</span>
<span class="nc" id="L134">        this.originX = originX;</span>
<span class="nc" id="L135">        this.originY = originY;</span>
<span class="nc" id="L136">        this.destX = destX;</span>
<span class="nc" id="L137">        this.destY = destY;</span>
<span class="nc" id="L138">    }</span>
    
    // Getters and Setters
    public String getShipmentId() {
<span class="nc" id="L142">        return shipmentId;</span>
    }
    
    public void setShipmentId(String shipmentId) {
<span class="fc" id="L146">        this.shipmentId = shipmentId;</span>
<span class="fc" id="L147">    }</span>
    
    public String getUpsTrackingId() {
<span class="nc" id="L150">        return upsTrackingId;</span>
    }
    
    public void setUpsTrackingId(String upsTrackingId) {
<span class="fc" id="L154">        this.upsTrackingId = upsTrackingId;</span>
<span class="fc" id="L155">    }</span>
    
    
    public String getAmazonOrderId() {
<span class="nc" id="L159">        return amazonOrderId;</span>
    }
    
    public void setAmazonOrderId(String amazonOrderId) {
<span class="nc" id="L163">        this.amazonOrderId = amazonOrderId;</span>
<span class="nc" id="L164">    }</span>
    
    public ShipmentStatus getStatus() {
<span class="nc" id="L167">        return status;</span>
    }
    
    public void setStatus(ShipmentStatus status) {
<span class="fc" id="L171">        this.status = status;</span>
<span class="fc" id="L172">    }</span>
    
    public Integer getOriginX() {
<span class="nc" id="L175">        return originX;</span>
    }
    
    public void setOriginX(Integer originX) {
<span class="nc" id="L179">        this.originX = originX;</span>
<span class="nc" id="L180">    }</span>
    
    public Integer getOriginY() {
<span class="nc" id="L183">        return originY;</span>
    }
    
    public void setOriginY(Integer originY) {
<span class="nc" id="L187">        this.originY = originY;</span>
<span class="nc" id="L188">    }</span>
    
    public Integer getDestX() {
<span class="nc" id="L191">        return destX;</span>
    }
    
    public void setDestX(Integer destX) {
<span class="nc" id="L195">        this.destX = destX;</span>
<span class="nc" id="L196">    }</span>
    
    public Integer getDestY() {
<span class="nc" id="L199">        return destY;</span>
    }
    
    public void setDestY(Integer destY) {
<span class="nc" id="L203">        this.destY = destY;</span>
<span class="nc" id="L204">    }</span>
    
    
    public BigDecimal getWeight() {
<span class="nc" id="L208">        return weight;</span>
    }
    
    public void setWeight(BigDecimal weight) {
<span class="fc" id="L212">        this.weight = weight;</span>
<span class="fc" id="L213">    }</span>
    
    public LocalDateTime getEstimatedDelivery() {
<span class="nc" id="L216">        return estimatedDelivery;</span>
    }
    
    public void setEstimatedDelivery(LocalDateTime estimatedDelivery) {
<span class="nc" id="L220">        this.estimatedDelivery = estimatedDelivery;</span>
<span class="nc" id="L221">    }</span>
    
    public LocalDateTime getActualDelivery() {
<span class="nc" id="L224">        return actualDelivery;</span>
    }
    
    public void setActualDelivery(LocalDateTime actualDelivery) {
<span class="nc" id="L228">        this.actualDelivery = actualDelivery;</span>
<span class="nc" id="L229">    }</span>
    
    public LocalDateTime getPickupTime() {
<span class="nc" id="L232">        return pickupTime;</span>
    }
    
    public void setPickupTime(LocalDateTime pickupTime) {
<span class="nc" id="L236">        this.pickupTime = pickupTime;</span>
<span class="nc" id="L237">    }</span>
    
    public Long getWorldId() {
<span class="nc" id="L240">        return worldId;</span>
    }
    
    public void setWorldId(Long worldId) {
<span class="nc" id="L244">        this.worldId = worldId;</span>
<span class="nc" id="L245">    }</span>
    
    public String getDeliveryAddress() {
<span class="nc" id="L248">        return deliveryAddress;</span>
    }
    
    public void setDeliveryAddress(String deliveryAddress) {
<span class="nc" id="L252">        this.deliveryAddress = deliveryAddress;</span>
<span class="nc" id="L253">    }</span>
    
    public String getDeliveryCity() {
<span class="nc" id="L256">        return deliveryCity;</span>
    }
    
    public void setDeliveryCity(String deliveryCity) {
<span class="nc" id="L260">        this.deliveryCity = deliveryCity;</span>
<span class="nc" id="L261">    }</span>
    
    public String getDeliveryZipCode() {
<span class="nc" id="L264">        return deliveryZipCode;</span>
    }
    
    public void setDeliveryZipCode(String deliveryZipCode) {
<span class="nc" id="L268">        this.deliveryZipCode = deliveryZipCode;</span>
<span class="nc" id="L269">    }</span>
    
    public User getUser() {
<span class="nc" id="L272">        return user;</span>
    }
    
    public void setUser(User user) {
<span class="fc" id="L276">        this.user = user;</span>
<span class="fc" id="L277">    }</span>
    
    public Truck getTruck() {
<span class="nc" id="L280">        return truck;</span>
    }
    
    public void setTruck(Truck truck) {
<span class="nc" id="L284">        this.truck = truck;</span>
<span class="nc" id="L285">    }</span>
    
    public List&lt;ShipmentPackage&gt; getPackages() {
<span class="nc" id="L288">        return packages;</span>
    }
    
    public void setPackages(List&lt;ShipmentPackage&gt; packages) {
<span class="nc" id="L292">        this.packages = packages;</span>
<span class="nc" id="L293">    }</span>
    
    public List&lt;ShipmentStatusHistory&gt; getStatusHistory() {
<span class="nc" id="L296">        return statusHistory;</span>
    }
    
    public void setStatusHistory(List&lt;ShipmentStatusHistory&gt; statusHistory) {
<span class="nc" id="L300">        this.statusHistory = statusHistory;</span>
<span class="nc" id="L301">    }</span>
    
    public List&lt;AddressChange&gt; getAddressChanges() {
<span class="nc" id="L304">        return addressChanges;</span>
    }
    
    public void setAddressChanges(List&lt;AddressChange&gt; addressChanges) {
<span class="nc" id="L308">        this.addressChanges = addressChanges;</span>
<span class="nc" id="L309">    }</span>
    
    // Helper methods
    public boolean canChangeAddress() {
<span class="nc bnc" id="L313" title="All 6 branches missed.">        return status == ShipmentStatus.CREATED || </span>
               status == ShipmentStatus.PICKED_UP || 
               status == ShipmentStatus.IN_TRANSIT;
    }
    
    public void updateStatus(ShipmentStatus newStatus) {
<span class="nc" id="L319">        this.status = newStatus;</span>
        // Add to status history
<span class="nc" id="L321">        ShipmentStatusHistory history = new ShipmentStatusHistory();</span>
<span class="nc" id="L322">        history.setShipment(this);</span>
<span class="nc" id="L323">        history.setStatus(newStatus);</span>
<span class="nc" id="L324">        history.setTimestamp(LocalDateTime.now());</span>
<span class="nc" id="L325">        this.statusHistory.add(history);</span>
<span class="nc" id="L326">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>